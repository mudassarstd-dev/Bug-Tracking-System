<form [formGroup]="bugForm" class="bug-dialog">
    <!-- TOP BAR -->
    <div class="dialog-topbar">
        <button mat-icon-button class="close-btn" (click)="close()">
            <mat-icon>close</mat-icon>
        </button>
    </div>

    <!-- STATUS + AVATARS + DATE -->
    <div class="bug-status-section">
        <div class="status-group">
            <div class="status-chip started">{{ bugForm.value.status }}</div>
            <div class="status-chip arrow">
                <mat-icon>keyboard_arrow_down</mat-icon>
            </div>
        </div>

        <!-- Avatars -->
        <div class="avatars">
            <img *ngFor="let user of assignees" [src]="user.avatar" class="avatar" />

            <button type="button" class="add-avatar hollow-add"
                (click)="toggleDropdown($event); $event.stopPropagation()">
                <div class="plus-badge">
                    <mat-icon>add</mat-icon>
                </div>
            </button>

            <!-- Dropdown Card -->
            <div class="custom-dropdown-card" *ngIf="dropdownOpen"
                [ngStyle]="{ top: dropdownPosition.top + 'px', left: dropdownPosition.left + 'px' }">
                <div class="dropdown-title">Assign To</div>
                <hr class="dropdown-divider" />

                <div class="dropdown-list">
                    <div class="dropdown-item" *ngFor="let user of allUsers" (click)="toggleAssignee(user)">
                        <img [src]="user.avatar" alt="avatar" class="avatar" />
                        <span class="name">{{ user.name }}</span>
                        <mat-checkbox [checked]="isAssigned(user)" color="primary"
                            (click)="$event.stopPropagation(); toggleAssignee(user)"></mat-checkbox>
                    </div>
                </div>
            </div>
        </div>

        <div class="spacer"></div>

        <div class="full-divider-vertical"></div>


        <div class="creation-date">
            <div class="date-text">
                <h3>Due Date</h3>
                <p>{{ bugForm.value.dueDate | date: 'MMM d, yyyy' }}</p>
            </div>
            <div class="half-divider-vertical"></div>
            <img src="assets/icons/calendar.png" alt="calendar" width="32" height="32" class="calendar-icon" (click)="$event.stopPropagation(); openDatePicker()" >
        </div>

    </div>

    <hr class="divider" />

    <!-- TITLE -->
    <div class="dialog-title">{{ bugForm.value.title }}</div>



    <!-- DROP ZONE -->
    <div class="drop-zone">
        <!-- Show existing or previewed image -->
        <img *ngIf="imagePreview || screenshotUrl" [src]="imagePreview || screenshotUrl" alt="Screenshot"
            class="preview-image" />

        <!-- Placeholder (only if no image) -->
        <div *ngIf="!imagePreview && !screenshotUrl" class="placeholder">
            <img src="assets/icons/gallery.png" alt="Add image" class="placeholder-icon" />
            <p class="placeholder-text">Add image here</p>
        </div>
    </div>

    <!-- BUG DETAILS -->
    <mat-form-field appearance="outline" class="bug-details-field" floatLabel="always">
        <mat-label>Bug Details</mat-label>
        <textarea matInput formControlName="details" rows="4" placeholder="Describe the issue..."></textarea>
    </mat-form-field>

    <div class="space"></div>

    <!-- FOOTER -->
    <!-- <div class="dialog-footer">
        <p>Want to replace the image? <span class="browse" (click)="fileInput.click()">Browse</span></p>
    </div> -->

    <!-- FOOTER -->
    <div class="dialog-footer">
        <p>Drop any image here or <span class="browse" (click)="fileInput.click()">Browse</span></p>
        <input type="file" #fileInput hidden accept="image/*" (change)="onFileSelected($event)" />
    </div>
</form>