<div class="assign-to-field">
  <label class="field-label">Assign To</label>

  <!-- Trigger -->
  <div class="custom-dropdown-trigger" (click)="toggleDropdown($event)">
    <span *ngIf="selected?.length; else placeholder">
      {{ selected.length }} user{{ selected.length > 1 ? 's' : '' }} selected
    </span>
    <ng-template #placeholder>Select users...</ng-template>
    <mat-icon class="dropdown-icon">expand_more</mat-icon>
  </div>

  <!-- Dropdown -->
  <div
    class="custom-dropdown-card"
    *ngIf="dropdownOpen"
    [ngStyle]="{ top: dropdownPosition.top + 'px', left: dropdownPosition.left + 'px' }"
  >
    <div class="dropdown-title">Assign To</div>
    <hr class="dropdown-divider" />

    <div class="dropdown-list">
      <div
        class="dropdown-item"
        *ngFor="let user of assignees"
        (click)="toggleAssignee(user)"
      >
        <img [src]="user.avatar" alt="avatar" class="avatar" />
        <span class="name">{{ user.username }}</span>

        <!-- âœ… Use helper method -->
        <mat-checkbox
          [checked]="isSelected(user)"
          color="primary"
          (click)="$event.stopPropagation(); toggleAssignee(user)"
        ></mat-checkbox>
      </div>
    </div>
  </div>

  <!-- Selected users -->
  <div class="selected-users" *ngIf="selected?.length">
    <div class="selected-user" *ngFor="let user of selected">
      <img [src]="user.avatar" alt="avatar" class="user-avatar" />
      <span>{{ user.username }}</span>
      <mat-icon class="remove-icon" (click)="removeUser(user)">close</mat-icon>
    </div>
  </div>
</div>
